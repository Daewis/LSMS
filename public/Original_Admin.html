<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/output.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2c2c3e; /* Darker track for sidebar */
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
    </style>
</head>
<body class="flex h-screen bg-gray-100 font-sans antialiased">

    <aside class="w-64 bg-gray-900 text-gray-200 flex flex-col shadow-lg">
        <div class="flex items-center justify-center h-16 border-b border-gray-700 px-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles text-purple-400 mr-2">
                <path d="M10 13v7l4-7h6l-9 7 3 4-8-7 4-7H3l9 7Z"/>
            </svg>
            <span class="text-xl font-semibold text-white">AdminApp</span>
        </div>

        <nav class="flex-1 px-2 py-4 space-y-2 overflow-y-auto">
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard mr-3">
                    <rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/>
                </svg>
                Dashboard
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list mr-3">
                    <rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 15h4"/><path d="M8 11h.01"/><path d="M8 15h.01"/>
                </svg>
                View Attendance
            </a>
            <a href="#" id="viewInternsLink" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-3">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                View Interns
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open mr-3">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
                View Logbook Report
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-more mr-3">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 10h.01"/><path d="M12 10h.01"/><path d="M16 10h.01"/>
                </svg>
                View Complaints & Suggestions
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-open mr-3">
                    <path d="M6 14V4a2 2 0 0 1 2-2h4l2 2h4a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2l2 2h4a2 2 0 0 1 2 2v4"/>
                </svg>
                View Project
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit mr-3">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4Z"/>
                </svg>
                Edit Details
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square mr-3">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                Live Chat
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-horizontal mr-3">
                    <path d="m17 5 3 3-3 3"/><path d="M19 8H5c-1.7 0-3 1.3-3 3v1c0 1.7 1.3 3 3 3h14c1.7 0 3-1.3 3-3v-1c0-1.7-1.3-3-3-3Z"/>
                </svg>
                Message
            </a>
            <a href="#" id="registerAdminLink" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-plus mr-3">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/>
                </svg>
                Register Admin
            </a>
        </nav>

        <div class="mt-auto px-2 py-4 border-t border-gray-700">
            <a href="#" class="flex items-center px-4 py-3 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings mr-3">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.04a2 2 0 0 1 0 2.83l-.04.04a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.04a2 2 0 0 1 0-2.83l.04-.04a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>
                </svg>
                Settings
            </a>
        </div>
    </aside>

    <div class="flex-1 flex flex-col">
        <header class="flex items-center justify-between h-16 bg-white border-b border-gray-200 px-6 shadow-md">
            <div class="flex items-center">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search text-gray-400">
                            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/>
                        </svg>
                    </span>
                    <input type="text" placeholder="Search..." class="pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <button class="text-gray-500 hover:text-gray-700 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell">
                        <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                    </svg>
                </button>

                <div class="relative group">
                    <button class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 focus:outline-none">
                        <img class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/40x40/cccccc/ffffff?text=AD" alt="Admin User">
                        <span id="loggedInUserName">Admin User</span> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down">
                            <path d="m6 9 6 6 6-6"/>
                        </svg>
                    </button>
                    <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Your profile</a>
                        <a href="#" id="signOutLink" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Sign out</a>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 p-6 overflow-y-auto">
            <div class="border border-dashed border-gray-300 rounded-lg p-6 h-full flex items-center justify-center text-gray-400 text-xl">
                Admin Content Area (e.g., Attendance Records, Project Submissions, etc.)
            </div>
        </main>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', async () => {
            const registerAdminLink = document.getElementById('registerAdminLink');
            const loggedInUserNameSpan = document.getElementById('loggedInUserName');
            const signOutLink = document.getElementById('signOutLink');

            if (!registerAdminLink || !loggedInUserNameSpan || !signOutLink) {
                console.error("Critical elements missing from the DOM!");
                // Potentially redirect to login or show an error
                return;
            }

            // --- Fetch user role and update UI ---
            try {
                const response = await fetch('/auth/role');
                const result = await response.json();

                if (response.ok && result.success) {
                    loggedInUserNameSpan.textContent = result.email || 'Admin User'; // Display logged-in email/username
                    if (result.role === 'superadmin') {
                        registerAdminLink.classList.remove('hidden'); // Show for superadmins
                    } else {
                        registerAdminLink.classList.add('hidden'); // Ensure hidden for other roles
                    }
                } else {
                    // Not authenticated or session expired, redirect to login
                    console.warn('Session invalid or expired. Redirecting to login.');
                    window.location.href = '/Sign_in.html'; // Or your admin login page
                }
            } catch (error) {
                console.error('Error fetching user role:', error);
                // Handle network errors or server issues
                window.location.href = '/Sign_in.html'; // Redirect on error
            }

            // --- Logout functionality ---
            signOutLink.addEventListener('click', async (event) => {
                event.preventDefault(); // Prevent default link behavior

                try {
                    const response = await fetch('/auth/logout', {
                        method: 'POST', // Match your backend /auth/logout route
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const result = await response.json();

                    if (response.ok && result.success) {
                        console.log('Logged out successfully.');
                        window.location.href = '/Sign_in.html'; // Redirect to login page after logout
                    } else {
                        console.error('Logout failed:', result.message);
                        alert('Logout failed: ' + (result.message || 'Server error.'));
                    }
                } catch (error) {
                    console.error('Error during logout:', error);
                    alert('An error occurred during logout. Please try again.');
                }
            });

            // You can add more event listeners here for other sidebar links
            // Example for "View Interns"
            const viewInternsLink = document.getElementById('viewInternsLink');
            if(viewInternsLink) {
                viewInternsLink.addEventListener('click', (event) => {
                    event.preventDefault();
                    // You can fetch and display intern data here
                    // For now, let's just log
                    console.log('View Interns clicked!');
                    // This is where you'd dynamically load data into the main content area
                    // For example: fetch('/api/admin/interns') and then render them.
                });
            }

            // Add similar event listeners for other sidebar links
            // e.g., 'View Attendance', 'Register Admin' (if superadmin)
            registerAdminLink.addEventListener('click', (event) => {
                event.preventDefault();
                // This is where you would load a form for registering an admin
                console.log('Register Admin clicked!');
                // Example: Dynamically load a form or redirect to a /register_admin.html page
            });
        });
    </script>
</body>
</html>